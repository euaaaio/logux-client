!function(){function e(e,t,i,n){Object.defineProperty(e,t,{get:i,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},s=i.parcelRequireb9bf;null==s&&((s=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var i={id:e,exports:{}};return n[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){o[e]=t},i.parcelRequireb9bf=s),s.register("lFX4J",(function(t,i){var n,o;e(t.exports,"resolve",(function(){return o}),(function(e){return o=e})),e(t.exports,"register",(function(){return n}),(function(e){return n=e}));var s={};n=function(e){for(var t=Object.keys(e),i=0;i<t.length;i++)s[t[i]]=e[t[i]]},o=function(e){var t=s[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),s("lFX4J").register(JSON.parse('{"b9p7K":"index.56f6e8c3.js","3tkLK":"refresh.f7f11930.svg","5DfSL":"success.5585cf5f.svg","dy5v4":"offline.c7da2f9d.svg","gb8nV":"error.8319e405.svg","jhajy":"offline.203f1963.png","3qTAD":"normal.60452f34.png","9RUMx":"error.a2ca88ad.png"}'));let r=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach((e=>e(...t)))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter((e=>e!==t))}});function d(e,t,i,n){i.id&&e.emit(`${t}-${i.type}-${i.id}`,i,n),e.emit(`${t}-${i.type}-`,i,n),e.emit(t,i,n)}class c{constructor(e={}){this.nodeId=e.nodeId,this.lastTime=0,this.sequence=0,this.store=e.store,this.emitter=r()}on(e,t){return this.emitter.on(e,t)}type(e,t,i={}){let n=i.event||"add",o=i.id||"";return this.emitter.on(`${n}-${e}-${o}`,t)}async add(e,t={}){if(void 0===e.type)throw new Error('Expected "type" in action');let i=!1;if(void 0===t.id&&(i=!0,t.id=this.generateId()),void 0===t.time&&(t.time=parseInt(t.id)),void 0===t.reasons&&(t.reasons=[]),d(this.emitter,"preadd",e,t),t.keepLast&&(this.removeReason(t.keepLast,{olderThan:t}),t.reasons.push(t.keepLast)),0===t.reasons.length&&i)return d(this.emitter,"add",e,t),d(this.emitter,"clean",e,t),t;if(0===t.reasons.length){let[i]=await this.store.byId(t.id);return!i&&(d(this.emitter,"add",e,t),d(this.emitter,"clean",e,t),t)}{let i=await this.store.add(e,t);return!1!==i&&(d(this.emitter,"add",e,t),i)}}generateId(){let e=Date.now();return e<=this.lastTime?(e=this.lastTime,this.sequence+=1):(this.lastTime=e,this.sequence=0),e+" "+this.nodeId+" "+this.sequence}each(e,t){t||(t=e,e={order:"created"});let i=this.store;return new Promise((n=>{!async function e(i){let o,s=await i();for(let e=s.entries.length-1;e>=0;e--){let i=s.entries[e];if(o=t(i[0],i[1]),!1===o)break}!1!==o&&s.next?e(s.next):n()}(i.get.bind(i,e))}))}async changeMeta(e,t){for(let e in t)if("id"===e||"added"===e||"time"===e||"subprotocol"===e||"indexes"===e)throw new Error('Meta "'+e+'" is read-only');if(t.reasons&&0===t.reasons.length){let i=await this.store.remove(e);if(i){for(let e in t)i[1][e]=t[e];d(this.emitter,"clean",i[0],i[1])}return!!i}return this.store.changeMeta(e,t)}removeReason(e,t={}){return this.store.removeReason(e,t,((e,t)=>{d(this.emitter,"clean",e,t)}))}byId(e){return this.store.byId(e)}}function a(e,t){if(e&&!t)return!1;if(!e&&t)return!0;if(e.time>t.time)return!1;if(e.time<t.time)return!0;let i=e.id.split(" "),n=t.id.split(" "),o=i[1],s=n[1];if(o>s)return!1;if(o<s)return!0;let r=parseInt(i[2]),d=parseInt(n[2]);if(r>d)return!1;if(r<d)return!0;let c=parseInt(i[0]),a=parseInt(n[0]);return!(c>a)&&c<a}class l{constructor(e,t,i){if(this.connected=!1,this.emitter=r(),t)this.Class=t;else{if("undefined"==typeof WebSocket)throw new Error("No WebSocket support");this.Class=WebSocket}this.url=e,this.opts=i}init(e){e.onerror=e=>{this.emitter.emit("error",e.error||new Error("WS Error"))},e.onclose=()=>{this.onclose()},e.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch{return void this.error(e.data)}this.emitter.emit("message",t)},this.ws=e}connect(){return this.ws?Promise.resolve():(this.emitter.emit("connecting"),this.init(new this.Class(this.url,void 0,this.opts)),new Promise((e=>{this.ws.onopen=()=>{this.connected=!0,this.emitter.emit("connect"),e()}})))}disconnect(){this.ws&&(this.ws.onclose=void 0,this.ws.close(),this.onclose())}on(e,t){return this.emitter.on(e,t)}send(e){this.ws&&this.ws.readyState===this.ws.OPEN?this.ws.send(JSON.stringify(e)):this.emitter.emit("error",new Error("WS was closed"))}error(e){let t=new Error("Wrong message format");t.received=e,this.emitter.emit("error",t)}onclose(){this.ws&&(this.connected=!1,this.emitter.emit("disconnect"),this.ws=void 0)}}function h(e,t){e.indexes[t]||(e.indexes[t]={added:[],entries:[]})}function u(e,t){let i=e.indexes;if(f(i)&&i.length>0)for(let e of i)t(e)}function p(e,t){return e.lastAdded+=1,t[1].added=e.lastAdded,e.added.push(t),u(t[1],(i=>{h(e,i),e.indexes[i].added.push(t)})),Promise.resolve(t[1])}function m(e,t){let i=t.added,n=0,o=e.added.length-1;for(;n<=o;){let t=o+n>>1,s=e.added[t][1].added;if(s<i)n=t+1;else{if(!(s>i)){e.added.splice(t,1);break}o=t-1}}}function g(e,t){for(let i=e.length-1;i>=0;i--)if(t===e[i][1].id)return i;return-1}function f(e){return void 0!==e}class y{constructor(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async add(e,t){let i=[e,t],n=t.id,o=this.entries;for(let e=0;e<o.length;e++){let[,s]=o[e];if(n===s.id)return!1;if(!a(s,t))return u(t,(e=>{h(this,e);let n=this.indexes[e].entries,o=n.findIndex((e=>!a(e[1],t)));n.splice(o,0,i)})),o.splice(e,0,i),p(this,i)}return u(t,(e=>{h(this,e),this.indexes[e].entries.push(i)})),o.push(i),p(this,i)}async byId(e){let t=g(this.entries,e);if(-1===t)return[null,null];{let[e,i]=this.entries[t];return[e,i]}}async remove(e,t){if(void 0===t&&-1===(t=g(this.entries,e)))return Promise.resolve(!1);let i=[this.entries[t][0],this.entries[t][1]];return u(i[1],(t=>{let i=this.indexes[t].entries,n=g(i,e);-1!==n&&i.splice(n,1)})),this.entries.splice(t,1),u(i[1],(e=>{m(this.indexes[e],i[1])})),m(this,i[1]),i}async get(e={}){let t,i=e.index,n=this;return i&&(n=this.indexes[i]||{added:[],entries:[]}),t="created"===e.order?n.entries:n.added,{entries:t.slice(0)}}async changeMeta(e,t){let i=g(this.entries,e);if(-1===i)return!1;{let e=this.entries[i][1];for(let i in t)e[i]=t[i];return!0}}async removeReason(e,t,i){let n=[];if(t.id){let n=g(this.entries,t.id);if(-1!==n){let o=this.entries[n][1],s=o.reasons.indexOf(e);-1!==s&&(o.reasons.splice(s,1),0===o.reasons.length&&(i(this.entries[n][0],o),this.remove(t.id)))}}else{this.entries=this.entries.filter((([o,s])=>{let r=t,d=s.reasons.indexOf(e);return-1===d||(!(!f(r.olderThan)||a(s,r.olderThan))||(!(!f(r.youngerThan)||a(r.youngerThan,s))||(!!(f(r.minAdded)&&s.added<r.minAdded)||(!!(f(r.maxAdded)&&s.added>r.maxAdded)||(s.reasons.splice(d,1),0!==s.reasons.length||(i(o,s),n.push(s),!1))))))}));let o=n.map((e=>e.added)),s=e=>!o.includes(e[1].added);this.added=this.added.filter(s);for(let e of n)u(e,(e=>{this.indexes[e].entries=this.indexes[e].entries.filter(s),this.indexes[e].added=this.indexes[e].added.filter(s)}))}}async clean(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async getLastAdded(){return this.lastAdded}async getLastSynced(){return{received:this.lastReceived,sent:this.lastSent}}async setLastSynced(e){void 0!==e.sent&&(this.lastSent=e.sent),void 0!==e.received&&(this.lastReceived=e.received)}}class b extends Error{static describe(e,t){return"timeout"===e?"A timeout was reached ("+t+" ms)":"wrong-format"===e?"Wrong message format in "+t:"unknown-message"===e?"Unknown message `"+t+"` type":"bruteforce"===e?"Too many wrong authentication attempts":"wrong-protocol"===e?`Logux supports protocols only from version ${t.supported}, but you use ${t.used}`:"wrong-subprotocol"===e?`Only ${t.supported} application subprotocols are supported, but you use ${t.used}`:"wrong-credentials"===e?"Wrong credentials":e}constructor(e,t,i){super(e),this.name="LoguxError",this.type=e,this.options=t,this.description=b.describe(e,t),this.received=!!i,i?(this.message="Logux received "+this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,b)}}async function w(e,t,i,n){if(!e.options.auth)return e.authenticated=!0,void n();try{if(await e.options.auth(t,i,e.remoteHeaders)){e.authenticated=!0,n();for(let t=0;t<e.unauthenticated.length;t++)e.onMessage(e.unauthenticated[t]);e.unauthenticated=[]}else e.sendError(new b("wrong-credentials")),e.destroy()}catch(t){"LoguxError"===t.name?(e.sendError(t),e.destroy()):e.error(t)}}function v(e,t){return e.remoteProtocol=t,t>=e.minProtocol||(e.sendError(new b("wrong-protocol",{supported:e.minProtocol,used:t})),e.destroy(),!1)}function I(e){try{e.emitter.emit("connect")}catch(t){if("LoguxError"===t.name)return e.sendError(t),!1;throw t}return!0}const S={"wrong-subprotocol":!0,"wrong-protocol":!0,timeout:!0},x=["connect","connected","error","debug","headers"];async function E(e,t,i){let n=i.added;if(void 0===n){let t=e.lastAddedCache;n=t>e.lastSent?t:e.lastSent}if(e.options.outMap)try{let o=await e.options.outMap(t,i);e.sendSync(n,[o])}catch(t){e.error(t)}else e.sendSync(n,[[t,i]])}class T{constructor(e,t,i,n={}){if(this.remoteNodeId=void 0,this.remoteProtocol=void 0,this.remoteSubprotocol=void 0,this.minProtocol=3,this.localProtocol=4,this.localNodeId=e,this.log=t,this.connection=i,this.options=n,this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=r(),this.timeouts=[],this.throwsError=!0,this.unbind=[t.on("add",((e,t)=>{this.onAdd(e,t)})),i.on("connecting",(()=>{this.onConnecting()})),i.on("connect",(()=>{this.onConnect()})),i.on("message",(e=>{this.onMessage(e)})),i.on("error",(e=>{"Wrong message format"===e.message?(this.sendError(new b("wrong-format",e.received)),this.connection.disconnect("error")):this.error(e)})),i.on("disconnect",(()=>{this.onDisconnect()}))],this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize(),this.localHeaders={},this.remoteHeaders={}}on(e,t){return this.emitter.on(e,t)}catch(e){this.throwsError=!1;let t=this.on("error",e);return()=>{this.throwsError=!0,t()}}waitFor(e){return this.state===e?Promise.resolve():new Promise((t=>{let i=this.on("state",(()=>{this.state===e&&(i(),t())}))}))}destroy(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(let e of this.unbind)e();clearTimeout(this.pingTimeout),this.endTimeout()}setLocalHeaders(e){this.localHeaders=e,this.connected&&this.sendHeaders(e)}send(e){if(this.connected){this.delayPing();try{this.connection.send(e)}catch(e){this.error(e)}}}onConnecting(){this.setState("connecting")}onConnect(){this.delayPing(),this.connected=!0}onDisconnect(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.authenticated=!1,this.connected=!1,this.setState("disconnected")}onMessage(e){this.delayPing();let t=e[0];this.authenticated||x.includes(t)?this[t+"Message"](...e.slice(1)):this.unauthenticated.push(e)}async onAdd(e,t){if(this.authenticated)if(this.lastAddedCache<t.added&&(this.lastAddedCache=t.added),this.received&&this.received[t.id])delete this.received[t.id];else if(this.options.outFilter)try{await this.options.outFilter(e,t)&&E(this,e,t)}catch(e){this.error(e)}else E(this,e,t)}syncError(e,t,i){let n=new b(e,t,i);if(this.emitter.emit("error",n),!S[e]&&this.throwsError)throw n}error(e){if(this.emitter.emit("error",e),this.connection.disconnect("error"),this.throwsError)throw e}setState(e){this.state!==e&&(this.state=e,this.emitter.emit("state"))}startTimeout(){if(!this.options.timeout)return;let e=this.options.timeout,t=setTimeout((()=>{this.connected&&this.connection.disconnect("timeout"),this.syncError("timeout",e)}),e);this.timeouts.push(t)}endTimeout(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())}delayPing(){this.options.ping&&(this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout((()=>{this.connected&&this.authenticated&&this.sendPing()}),this.options.ping))}async syncSinceQuery(e){let t=[];await this.log.each({order:"added"},((i,n)=>!(n.added<=e)&&(this.options.outFilter?t.push(this.options.outFilter(i,n).then((e=>!!e&&[i,n])).catch((e=>{this.error(e)}))):t.push(Promise.resolve([i,n])),!0)));let i=await Promise.all(t),n={added:0};return n.entries=i.filter((e=>(e&&n.added<e[1].added&&(n.added=e[1].added),!1!==e))),n}async syncSince(e){let t=await this.syncSinceQuery(e);this.connected&&(t.entries.length>0?this.options.outMap?Promise.all(t.entries.map((e=>this.options.outMap(e[0],e[1])))).then((e=>{this.sendSync(t.added,e)})).catch((e=>{this.error(e)})):this.sendSync(t.added,t.entries):this.setState("synchronized"))}setLastSent(e){this.lastSent<e&&(this.lastSent=e,this.log.store.setLastSynced({sent:e}))}setLastReceived(e){this.lastReceived<e&&(this.lastReceived=e),this.log.store.setLastSynced({received:e})}now(){return Date.now()}async initialize(){let[e,t]=await Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]);this.initialized=!0,this.lastSent=e.sent,this.lastReceived=e.received,this.lastAddedCache=t,this.connection.connected&&this.onConnect()}sendDuilian(){this.send(["duilian",Object.keys(k)[0]])}duilianMessage(e){k[e]&&this.send(["duilian",k[e]])}}T.prototype.sendConnect=async function(){let e=["connect",this.localProtocol,this.localNodeId,this.lastReceived],t={};this.options.token&&("function"==typeof this.options.token?t.token=await this.options.token():t.token=this.options.token),this.options.subprotocol&&(t.subprotocol=this.options.subprotocol),Object.keys(t).length>0&&e.push(t),this.options.fixTime&&(this.connectSended=this.now()),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.startTimeout(),this.send(e)},T.prototype.sendConnected=async function(e,t){let i=["connected",this.localProtocol,this.localNodeId,[e,t]],n={};this.options.token&&("function"==typeof this.options.token?n.token=await this.options.token():n.token=this.options.token),this.options.subprotocol&&(n.subprotocol=this.options.subprotocol),Object.keys(n).length>0&&i.push(n),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.send(i)},T.prototype.connectMessage=function(e,t,i,n){let o=this.now();n||(n={}),this.remoteNodeId=t,v(this,e)&&(this.remoteSubprotocol=n.subprotocol||"0.0.0",I(this)?w(this,t,n.token,(()=>{this.baseTime=this.now(),this.sendConnected(o,this.baseTime),this.syncSince(i)})):this.destroy())},T.prototype.connectedMessage=function(e,t,i,n){if(n||(n={}),this.endTimeout(),this.remoteNodeId=t,v(this,e)){if(this.baseTime=i[1],this.options.fixTime){let e=this.now(),t=i[1]-i[0],n=e-this.connectSended-t;this.timeFix=Math.floor(this.connectSended-i[0]+n/2)}this.remoteSubprotocol=n.subprotocol||"0.0.0",I(this)?w(this,t,n.token,(()=>{this.syncSince(this.lastSent)})):this.destroy()}},T.prototype.sendSync=function(e,t){this.startTimeout();let i=[];for(let[e,n]of t){let t={};for(let e in n)"id"===e?t.id=n.id.split(" "):"added"!==e&&(t[e]=n[e]);this.timeFix&&(t.time-=this.timeFix),t.id[0]=parseInt(t.id[0])-this.baseTime,t.id[2]=parseInt(t.id[2]),t.time-=this.baseTime,t.id[1]===this.localNodeId&&(0===t.id[2]?t.id=t.id[0]:t.id=[t.id[0],t.id[2]]),i.unshift(e,t)}this.syncing+=1,this.setState("sending"),this.send(["sync",e].concat(i))},T.prototype.sendSynced=function(e){this.send(["synced",e])},T.prototype.syncMessage=async function(e,...t){let i=[];for(let e=0;e<t.length-1;e+=2){let n=t[e],o=t[e+1];"number"==typeof o.id?o.id=o.id+this.baseTime+" "+this.remoteNodeId+" 0":(o.id[0]=o.id[0]+this.baseTime,2===o.id.length?o.id=o.id[0]+" "+this.remoteNodeId+" "+o.id[1]:o.id=o.id.join(" ")),o.time=o.time+this.baseTime,this.timeFix&&(o.time=o.time+this.timeFix);let s=Promise.resolve([n,o]);this.options.inMap&&(s=s.then((([e,t])=>this.options.inMap(e,t))).catch((e=>{this.error(e)}))),s.then((e=>e&&this.options.inFilter?this.options.inFilter(...e).then((t=>!!t&&e)).catch((e=>{this.error(e)})):e)).then((e=>!!e&&(this.received&&(this.received[e[1].id]=!0),this.log.add(e[0],e[1])))),i.push(s)}await Promise.all(i),this.setLastReceived(e),this.sendSynced(e)},T.prototype.syncedMessage=function(e){this.endTimeout(),this.setLastSent(e),this.syncing>0&&(this.syncing-=1),0===this.syncing&&this.setState("synchronized")},T.prototype.sendPing=function(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)},T.prototype.pingMessage=function(e){this.setLastReceived(e),this.connected&&this.authenticated&&this.send(["pong",this.lastAddedCache])},T.prototype.pongMessage=function(e){this.setLastReceived(e),this.endTimeout()},T.prototype.sendDebug=function(e,t){this.send(["debug",e,t])},T.prototype.debugMessage=function(e,t){this.emitter.emit("debug",e,t)},T.prototype.sendError=function(e){let t=["error",e.type];void 0!==e.options&&t.push(e.options),this.send(t),this.emitter.emit("clientError",e)},T.prototype.errorMessage=function(e,t){this.syncError(e,t,!0)},T.prototype.sendHeaders=function(e){this.send(["headers",e])},T.prototype.headersMessage=function(e){this.remoteHeaders=e,this.emitter.emit("headers",e)};const k={"金木水火土":"板城烧锅酒"},L={fixTime:!0,timeout:2e4,ping:5e3};class A extends T{constructor(e,t,i,n={}){super(e,t,i,n={...L,...n})}onConnect(){this.connected||(this.connected=!0,this.initializing=this.initializing.then((()=>{this.connected&&this.sendConnect()})))}}class P{constructor(e,t){this.connected=!1,this.emitter=r(),this.type=t,this.pair=e}other(){return"left"===this.type?this.pair.right:this.pair.left}on(e,t){return this.emitter.on(e,t)}connect(){if(this.connected)throw new Error("Connection already established");return this.emitter.emit("connecting"),new Promise((e=>{setTimeout((()=>{this.other().connected=!0,this.connected=!0,this.other().emitter.emit("connect"),this.emitter.emit("connect"),e()}),this.pair.delay)}))}disconnect(e){if(this.connected)return this.connected=!1,this.emitter.emit("disconnect",e),new Promise((e=>{setTimeout((()=>{this.other().connected=!1,this.other().emitter.emit("disconnect"),e()}),1)}));throw new Error("Connection already finished")}send(e){if(!this.connected)throw new Error("Connection should be started before sending a message");setTimeout((()=>{this.other().emitter.emit("message",e)}),this.pair.delay)}}const C={minDelay:1e3,maxDelay:5e3,attempts:1/0},R=["wrong-protocol","wrong-subprotocol","wrong-credentials"];class U{constructor(e,t={}){this.connection=e,this.options={...C,...t},this.reconnecting=e.connected,this.connecting=!1,this.attempts=0,this.unbind=[this.connection.on("message",(e=>{"error"===e[0]&&R.includes(e[1])&&(this.reconnecting=!1)})),this.connection.on("connecting",(()=>{this.connecting=!0})),this.connection.on("connect",(()=>{this.attempts=0,this.connecting=!1})),this.connection.on("disconnect",(()=>{this.connecting=!1,this.reconnecting&&this.reconnect()})),()=>{clearTimeout(this.timer)}];let i=()=>{!this.reconnecting||this.connected||this.connecting||"undefined"==typeof document||document.hidden||this.connect()},n=()=>{!this.reconnecting||this.connected||this.connecting||navigator.onLine&&this.connect()},o=()=>{this.disconnect("freeze")};"undefined"!=typeof document&&"undefined"!=typeof window&&document.addEventListener&&window.addEventListener&&(document.addEventListener("visibilitychange",i,!1),window.addEventListener("focus",n,!1),window.addEventListener("online",n,!1),window.addEventListener("resume",n,!1),window.addEventListener("freeze",o,!1),this.unbind.push((()=>{document.removeEventListener("visibilitychange",i,!1),window.removeEventListener("focus",n,!1),window.removeEventListener("online",n,!1),window.removeEventListener("resume",n,!1),window.removeEventListener("freeze",o,!1)})))}connect(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()}disconnect(e){return"timeout"!==e&&"error"!==e&&"freeze"!==e&&(this.reconnecting=!1),this.connection.disconnect(e)}destroy(){for(let e of this.unbind)e();this.disconnect("destroy")}reconnect(){if(this.attempts>this.options.attempts-1)return this.reconnecting=!1,void(this.attempts=0);let e=this.nextDelay();this.timer=setTimeout((()=>{!this.reconnecting||this.connecting||this.connected||this.connect()}),e)}send(...e){return this.connection.send(...e)}on(...e){return this.connection.on(...e)}nextDelay(){let e=this.options.minDelay*2**this.attempts,t=Math.random(),i=.5*t*e;return 1===Math.floor(10*t)&&(i=-i),Math.min(e+i,this.options.maxDelay)||0}get connected(){return this.connection.connected}get emitter(){return this.connection.emitter}}function M(e){e.includes(" ")&&(e=e.split(" ")[1]);let t=e.split(":");if(1===t.length)return{nodeId:e,userId:void 0,clientId:e};return{nodeId:e,userId:t[0],clientId:t[0]+":"+t[1]}}function N(e,t,i={}){let n,o=e.on?e:e.node,s="disconnected"===o.state,r=!1,d=!1;void 0===i.duration&&(i.duration=3e3);let c=[],a={};function l(){0===Object.keys(a).length&&(r?(r=!1,t("synchronizedAfterWait"),n=setTimeout((()=>{t("synchronized")}),i.duration)):t("synchronized"))}function h(){clearTimeout(n),d||("disconnected"===o.state?(s=!0,t(r?"wait":"disconnected")):"synchronized"===o.state?(s=!1,l()):"connecting"===o.state?n=setTimeout((()=>{t("connecting"+(r?"AfterWait":""))}),100):t(e.state+(r?"AfterWait":"")))}c.push(o.on("state",h)),c.push(e.node.on("error",(e=>{"wrong-protocol"===e.type||"wrong-subprotocol"===e.type?(d=!0,t("protocolError")):"timeout"!==e.type&&t("syncError",{error:e})}))),c.push(e.node.on("clientError",(e=>{t("syncError",{error:e})})));let u=e.on?e:e.log;return c.push(u.on("add",((e,i)=>{"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&("logux/processed"===e.type?(delete a[e.id],l()):"logux/undo"===e.type?delete a[e.id]:i.sync&&(a[i.id]=!0),"logux/undo"===e.type&&e.reason?"denied"===e.reason?t("denied",{action:e,meta:i}):t("error",{action:e,meta:i}):s&&i.sync&&i.added&&(r||t("wait"),r=!0))}))),h(),()=>{for(let e of c)e()}}function F(e,t){for(let i in t)e.style[i]=t[i]}const D={boxSizing:"content-box",visibility:"visible",textIndent:"0",textTransform:"none",wordSpacing:"normal",letterSpacing:"normal",fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineHeight:"auto"};let H=(e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&i[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t};class O extends Error{constructor(e){super(`Server undid ${e.action?e.action.type:"action"} because of ${e.reason}`),this.name="LoguxUndoError",this.action=e}}let z=["id","time","subprotocol"];function J(e){localStorage.setItem(e.options.prefix+":tab:"+e.tabId,Date.now())}function _(e,t){e.log.removeReason("tab"+t).then((()=>{e.isLocalStorage&&localStorage.removeItem(e.options.prefix+":tab:"+t)}))}function W(e,t){return e.options.prefix+":"+e.options.userId+":"+t}function $(e,t,i){if(!e.isLocalStorage)return;let n=W(e,t),o=JSON.stringify(i);try{localStorage.setItem(n,o)}catch(t){console.error(t),e.isLocalStorage=!1,e.role="leader",e.emitter.emit("role"),e.node.connection.connect()}}function j(e){let t=localStorage.getItem(W(e,"leader")),i=[];return"string"==typeof t&&(i=JSON.parse(t)),i}function K(e){$(e,"leader",[e.tabId,Date.now()])}function V(e){"disconnected"!==e.state&&Q(e,"disconnected"),Y(e)}function X(e){clearTimeout(e.watching),e.watching=setTimeout((()=>{B(e)?X(e):V(e)}),e.roleTimeout)}function q(e,t){if(e.role!==t){let i=e.node;if(e.role=t,clearTimeout(e.watching),"leader"===t?(localStorage.removeItem(W(e,"state")),e.leadership=setInterval((()=>{e.unloading||K(e)}),e.leaderPing),i.connection.connect()):(clearTimeout(e.elections),clearInterval(e.leadership),"disconnected"!==i.state&&e.node.connection.disconnect()),"follower"===t){let t="disconnected",i=localStorage.getItem(W(e,"state"));i&&null!==i&&(t=JSON.parse(i)),t!==e.state&&(e.state=t,e.emitter.emit("state"))}e.emitter.emit("role")}}function B(e){let t=j(e);return t[1]&&t[1]>=Date.now()-e.leaderTimeout}function Y(e){K(e),q(e,"candidate"),e.elections=setTimeout((()=>{j(e)[0]===e.tabId?q(e,"leader"):(q(e,"follower"),X(e))}),e.electionDelay)}function Q(e,t){e.state=t,e.emitter.emit("state"),$(e,"state",e.state)}function G(e){return e.returnValue="unsynced","unsynced"}function Z(e){return"%c"+e+"%c"}function ee(e,t){e="%cLogux%c "+e;let i=Array.from(e.match(/%c/g)).map(((e,t)=>0===t?"color:#ffa200;font-weight:bold":t%2==0?"font-weight:bold":"font-weight:normal"));if(t){console.groupCollapsed(e,...i);for(let e in t)"string"==typeof t[e]?console.log(e+": %c"+t[e],"font-weight:bold"):console.log(e,t[e]);console.groupEnd()}else console.log(e,...i)}var te;s.register("7P3Ut",(function(t,i){var n;e(t.exports,"getBundleURL",(function(){return n}),(function(e){return n=e}));var o={};function s(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(e){var t=o[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return s(e[2])}return"/"}(),o[e]=t),t}})),te=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("3tkLK");var ie;ie=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("5DfSL");var ne;ne=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("dy5v4");var oe;oe=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("gb8nV");let se={base:{position:"fixed",width:"15.4em",height:"4em",lineHeight:"1.4",margin:"1.5em",paddingLeft:"4.2em",opacity:"0.8",borderRadius:"0.4em",color:"#fff",fontFamily:"Helvetica Neue, sans-serif",zIndex:"999",backgroundPosition:"1.2em center",backgroundRepeat:"no-repeat",backgroundSize:"1.8em"},text:{display:"table-cell",verticalAlign:"middle",height:"4em"},synchronized:{backgroundColor:"#000",backgroundImage:"url("+t(ie)+")"},disconnected:{backgroundColor:"#000",backgroundImage:"url("+t(ne)+")"},wait:{backgroundColor:"#000",backgroundImage:"url("+t(ne)+")"},sending:{backgroundColor:"#000",backgroundImage:"url("+t(te)+")"},error:{backgroundColor:"#F42A2A",backgroundImage:"url("+t(oe)+")"},protocolError:{backgroundColor:"#000",backgroundImage:"url("+t(te)+")"}};var re;re=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("jhajy");var de;de=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("3qTAD");var ce;ce=s("7P3Ut").getBundleURL("b9p7K")+s("lFX4J").resolve("9RUMx");let ae=new class{constructor(e=1){this.delay=e,this.left=new P(this,"left"),this.right=new P(this,"right")}}(500),le=new c({store:new y,nodeId:"server:uuid"});new T("server:uuid",le,ae.right),le.on("add",((e,t)=>{"logux/processed"!==e.type&&setTimeout((()=>{le.add({type:"logux/processed",id:t.id})}),500)}));let he=new class extends class{get state(){return this.node.state}get connected(){return"disconnected"!==this.state&&"connecting"!==this.state}start(){this.cleanPrevActions(),this.node.connection.connect()}sync(e,t={}){return t.sync=!0,void 0===t.id&&(t.id=this.log.generateId()),this.log.add(e,t),function(e,t){if(e.processing[t])return e.processing[t][0];let i,n,o=new Promise(((e,t)=>{i=e,n=t}));return e.processing[t]=[o,i,n],o}(this,t.id)}type(e,t,i){return this.log.type(e,t,i)}on(e,t){return"state"===e?this.node.emitter.on(e,t):"user"===e?this.emitter.on(e,t):this.log.emitter.on(e,t)}changeUser(e,t){let i=this.node.connected;i&&this.node.connection.disconnect("destroy"),this.options.userId=e,this.options.token=t,this.clientId=e+":"+this.getClientId(),this.nodeId=this.clientId+":"+this.tabId,this.log.nodeId=this.nodeId,this.node.localNodeId=this.nodeId,this.node.options.token=t,this.emitter.emit("user",e),i&&this.node.connection.connect()}waitFor(e){return this.state===e?Promise.resolve():new Promise((t=>{let i=this.on("state",(()=>{this.state===e&&(i(),t())}))}))}destroy(){this.onUnload(),this.node.destroy(),clearInterval(this.pinging),"undefined"!=typeof window&&window.removeEventListener&&window.removeEventListener("unload",this.onUnload)}clean(){return this.destroy(),this.log.store.clean?this.log.store.clean():Promise.resolve()}cleanPrevActions(){if(this.isLocalStorage)for(let e in localStorage){let t=this.options.prefix+":tab:";if(e.slice(0,t.length)===t){let i=parseInt(localStorage.getItem(e));Date.now()-i>this.tabTimeout&&_(this,e.slice(t.length))}}}onUnload(){this.pinging&&_(this,this.tabId)}getClientId(){return H(8)}constructor(e={}){if(this.options=e,void 0===this.options.prefix&&(this.options.prefix="logux"),this.isLocalStorage=!1,"undefined"!=typeof localStorage){let e=H();try{localStorage.setItem(e,"1"),localStorage.removeItem(e),this.isLocalStorage=!0}catch{}}this.options.time?(this.tabId=this.options.time.lastId+1+"",this.clientId=this.options.userId+":"+this.tabId):(this.clientId=this.options.userId+":"+this.getClientId(),this.tabId=H(8)),this.nodeId=this.clientId+":"+this.tabId;let t,i=this.options.store||new y;t=this.options.time?this.options.time.nextLog({store:i,nodeId:this.nodeId}):new c({store:i,nodeId:this.nodeId}),this.log=t,t.on("preadd",((e,t)=>{M(t.id).nodeId!==this.nodeId||t.subprotocol||(t.subprotocol=this.options.subprotocol),t.sync&&!t.resubscribe&&t.reasons.push("syncing")})),this.last={},this.subscriptions={};let n={},o={};this.emitter=r(),this.on("add",((e,t)=>{let i,s,r=e.type;if("logux/processed"!==r&&"logux/undo"!==r||this.log.removeReason("syncing",{id:e.id}),"logux/subscribe"!==r||t.resubscribe)if("logux/unsubscribe"===r)o[t.id]=e;else if("logux/processed"===r){if(o[e.id]){let t=o[e.id];i=JSON.stringify({...t,type:"logux/subscribe"});let n=this.subscriptions[i];n&&(1===n?delete this.subscriptions[i]:this.subscriptions[i]=n-1)}if(n[e.id]){let o=n[e.id];delete n[e.id],i=JSON.stringify(o),this.subscriptions[i]?this.subscriptions[i]+=1:this.subscriptions[i]=1,s=this.last[o.channel],s&&!a(s,t)||(this.last[o.channel]={id:t.id,time:t.time})}"logux/processed"===r&&this.processing[e.id]&&(this.processing[e.id][1](t),delete this.processing[e.id])}else"logux/undo"===r?(this.processing[e.id]&&(this.processing[e.id][2](new O(e)),delete this.processing[e.id]),delete n[e.id],delete o[e.id]):t.channels&&(t.id.includes(" "+this.clientId+":")||t.channels.forEach((e=>{s=this.last[e],s&&!a(s,t)||(this.last[e]={id:t.id,time:t.time})})));else n[t.id]=e})),this.tabPing=6e4,this.tabTimeout=10*this.tabPing;let s,d="tab"+this.tabId;if(this.isLocalStorage){let e=t.on("add",((t,i)=>{i.reasons.includes(d)&&(J(this),this.pinging=setInterval((()=>{J(this)}),this.tabPing),e())}))}if("string"==typeof this.options.server){let e=new l(this.options.server);s=new U(e,{minDelay:this.options.minDelay,maxDelay:this.options.maxDelay,attempts:this.options.attempts})}else s=this.options.server;if(this.options.time||(void 0===this.options.timeout&&(this.options.timeout=2e4),void 0===this.options.ping&&(this.options.ping=5e3)),this.node=new A(this.nodeId,this.log,s,{subprotocol:this.options.subprotocol,outFilter:async(e,t)=>!!t.sync&&M(t.id).userId===this.options.userId,timeout:this.options.timeout,fixTime:!this.options.time,outMap:async(e,t)=>{let i={};for(let e in t)"subprotocol"===e?t.subprotocol!==this.options.subprotocol&&(i.subprotocol=t.subprotocol):z.includes(e)&&(i[e]=t[e]);return[e,i]},token:this.options.token,ping:this.options.ping}),/^ws:\/\//.test(this.options.server)&&!e.allowDangerousProtocol){let e=this.node.on("state",(()=>{"synchronized"===this.node.state&&(e(),"development"!==this.node.remoteHeaders.env&&(console.error("Without SSL, old proxies block WebSockets. Use WSS for Logux or set allowDangerousProtocol option."),this.destroy()))}))}this.node.on("debug",((e,t)=>{"error"===e&&console.error("Error on Logux server:\n",t)}));let h=!0;this.node.on("state",(()=>{let e=this.node.state;if("synchronized"===e||"sending"===e){if(h){h=!1;for(let e in this.subscriptions){let t=JSON.parse(e),i=this.last[t.channel];i&&(t.since=i),this.log.add(t,{sync:!0,resubscribe:!0})}}}else"disconnected"===this.node.state&&(h=!0)})),this.onUnload=this.onUnload.bind(this),"undefined"!=typeof window&&window.addEventListener&&window.addEventListener("unload",this.onUnload),this.processing={}}}{get state(){return this.leaderState}set state(e){this.leaderState=e}start(){if(this.cleanPrevActions(),!this.isLocalStorage)return this.role="leader",this.emitter.emit("role"),void this.node.connection.connect();B(this)?(q(this,"follower"),X(this)):Y(this)}destroy(){super.destroy(),clearTimeout(this.watching),clearTimeout(this.elections),clearInterval(this.leadership),"undefined"!=typeof window&&window.removeEventListener&&window.removeEventListener("storage",this.onStorage)}clean(){return this.isLocalStorage&&(localStorage.removeItem(W(this,"add")),localStorage.removeItem(W(this,"state")),localStorage.removeItem(W(this,"client")),localStorage.removeItem(W(this,"leader"))),super.clean()}changeUser(e,t){$(this,"user",[this.tabId,e]),super.changeUser(e,t)}type(e,t,i={}){if("preadd"===i.event)return this.log.type(e,t,i);{let n=i.event||"add",o=i.id||"";return this.emitter.on(`${n}-${e}-${o}`,t)}}on(e,t){return"preadd"===e?this.log.emitter.on(e,t):this.emitter.on(e,t)}onStorage(e){if(null===e.newValue)return;let t;if(e.key===W(this,"add")){if(t=JSON.parse(e.newValue),t[0]!==this.tabId){let e=t[1],n=t[2];n.tab&&n.tab!==this.tabId||(i=this.log.store,Array.isArray(i.entries)&&Array.isArray(i.added)&&this.log.store.add(e,n),d(this.emitter,"add",e,n),"leader"===this.role&&this.node.onAdd(e,n))}}else if(e.key===W(this,"leader"))t=JSON.parse(e.newValue),0===t.length?V(this):t[0]!==this.tabId&&"candidate"!==this.role&&(q(this,"follower"),X(this));else if(e.key===W(this,"state")){let t=JSON.parse(localStorage.getItem(e.key));this.leaderState!==t&&(this.leaderState=t,this.emitter.emit("state"))}else if(e.key===W(this,"user"))t=JSON.parse(e.newValue),t[0]!==this.tabId&&this.emitter.emit("user",t[1]);else if(e.key===W(this,"subprotocol")){let t=JSON.parse(e.newValue),i=function(e,t){let i=e.split("."),n=t.split(".");for(let e=0;e<3;e++){let t=parseInt(i[e]||0),o=parseInt(n[e]||0);if(t>o)return 1;if(t<o)return-1}return 0}(this.options.subprotocol,t);if(1===i)$(this,"subprotocol",this.options.subprotocol);else if(-1===i){let e=new b("wrong-subprotocol",{supported:t,used:this.options.subprotocol},!0);this.node.emitter.emit("error",e)}}var i}onUnload(){"leader"===this.role&&(this.unloading=!0,$(this,"leader",[])),super.onUnload()}getClientId(){let e=W(this,"client");if(this.isLocalStorage){if(localStorage.getItem(e))return localStorage.getItem(e);{let t=super.getClientId();return localStorage.setItem(e,t),t}}return super.getClientId()}constructor(e={}){if(super(e),this.role="candidate",this.roleTimeout=3e3+Math.floor(1e3*Math.random()),this.leaderTimeout=5e3,this.leaderPing=2e3,this.electionDelay=1e3,this.leaderState=this.node.state,this.node.on("state",(()=>{"leader"===this.role&&Q(this,this.node.state)})),this.log.on("add",((e,t)=>{d(this.emitter,"add",e,t),t.tab!==this.tabId&&$(this,"add",[this.tabId,e,t])})),this.log.on("clean",((e,t)=>{d(this.emitter,"clean",e,t)})),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("storage",(e=>this.onStorage(e))),window.addEventListener("unload",(e=>this.onUnload(e)))),this.isLocalStorage){let e=W(this,"subprotocol");localStorage.getItem(e)!==this.options.subprotocol&&$(this,"subprotocol",this.options.subprotocol)}}}({subprotocol:location.hash.slice(1)||"1.0.0",userId:"10",server:"wss://example.com/"}),ue=new A(he.node.localNodeId,he.log,ae.left);ue.connection.url="wss://example.com/",ue.emitter=he.node.emitter,he.node=ue,function(e){let t=document,i=!1,n=[],o=!1,s=()=>{i&&(t.title=i,i=!1)},r=()=>{t.hidden&&!i?(i=t.title,t.title="* "+t.title):s(),t.hidden&&(o=setTimeout(r,1e3))},d=()=>{!t.hidden&&o&&(o=clearTimeout(o),s())};t&&void 0!==t.hidden&&(n.push(e.node.on("error",(e=>{"timeout"===e.type||o||r()}))),n.push(e.on("add",(e=>{"logux/undo"===e.type&&e.reason&&!o&&r()}))),document.addEventListener("visibilitychange",d,!1),n.push((()=>{document.removeEventListener("visibilitychange",d,!1)})))}(he),function(e){let t="disconnected"===e.state,i=!1,n=()=>{"disconnected"===e.state?t=!0:"synchronized"===e.state&&(t=!1,i=!1),"undefined"!=typeof window&&window.addEventListener&&("follower"!==e.role&&i&&t?window.addEventListener("beforeunload",G):window.removeEventListener("beforeunload",G))},o=[];o.push(e.on("role",n)),o.push(e.on("state",n)),n(),o.push(e.on("add",((e,o)=>{"logux/subscribe"!==e.type&&"logux/unsubscribe"!==e.type&&t&&o.sync&&o.added&&(i=!0,n())})))}(he),function(e,t){let i=t.normal,n=t.offline,o=t.error,s=[],r=document,d=!1,c=!1;function a(){e.connected&&c!==i?d.href=c=i:!e.connected&&n&&c!==n&&c!==o&&(d.href=c=n)}function l(){o&&c!==o&&(d.href=c=o)}r&&(d=r.querySelector('link[rel~="icon"]'),void 0===i&&(i=d?d.href:""),d||(d=r.createElement("link"),d.rel="icon",d.href="",r.head.appendChild(d)),s.push(e.on("state",a)),a(),s.push(e.on("add",(e=>{"logux/undo"===e.type&&e.reason&&l()}))),s.push(e.node.on("error",(e=>{"timeout"!==e.type&&l()}))))}(he,{normal:t(de),offline:t(re),error:t(ce)}),function(e,t){let i=t.messages,n=t.position||"bottom-right",o=t.styles,s=document.createElement("div"),r=document.createElement("span");s.setAttribute("role","alert"),F(s,D),F(s,o.base),F(r,o.text),function(e,t){let i=e.style;"middle-center"===t||"center-middle"===t?(i.top="50%",i.left="50%",i.transform="translate(-50%, -50%)"):t.split("-").forEach((e=>{"middle"===e?(i.top="50%",i.transform="translateY(-50%)"):"center"===e?(i.left="50%",i.transform="translateX(-50%)"):i[e]="0"}))}(s,n);let d=(e,t)=>{r.innerHTML=t,F(s,e),s.style.display="block"},c=N(e,(e=>{"sendingAfterWait"===e||"connectingAfterWait"===e?d(o.sending,i.sending):"synchronizedAfterWait"===e?d(o.synchronized,i.synchronized):"synchronized"===e?s.style.display="none":"disconnected"===e?d(o.disconnected,i.disconnected):"wait"===e?d(o.wait,i.wait):"protocolError"===e?d(o.protocolError,i.protocolError):"syncError"===e?d(o.error,i.syncError):"error"===e?d(o.error,i.error):"denied"===e&&d(o.error,i.denied)}),t);s.appendChild(r),document.body.appendChild(s)}(he,{messages:{synchronized:"Your data has been saved",disconnected:"No Internet connection",wait:"No Internet connection<br>Your data has not been saved",sending:"Data saving",syncError:"Server error<br>Your data has not been saved",error:"Server error<br>You changes was reverted",denied:"You have no access<br>You changes was reverted",protocolError:"Saving is not working<br>Refresh the page"},styles:se}),function(e,t={}){let i=e.node,n={},o=[],s=!1;!1!==t.state&&o.push(e.on("state",(()=>{let t;"connecting"===e.state&&i.connection.url?t={"Node ID":i.localNodeId,Server:i.connection.url}:e.connected&&!s&&i.remoteNodeId?(s=!0,t={"Server ID":i.remoteNodeId}):e.connected||(s=!1),ee("state is "+Z(e.state),t)}))),!1!==t.role&&o.push(e.on("role",(()=>{ee("tab role is "+Z(e.role))})));let r={},d=(t.ignoreActions||[]).reduce(((e,t)=>(e[t]=!0,e)),{});!1!==t.add&&o.push(e.on("add",((t,o)=>{if(o.tab&&o.tab!==e.tabId)return;if(d[t.type])return;let s;if(o.sync&&(n[o.id]=t),"logux/subscribe"===t.type)s="subscribing to "+Z(t.channel)+" channel",2===Object.keys(t).length?ee(s):ee(s,{Action:t});else if("logux/subscribed"===t.type)ee("subscribed to "+Z(t.channel)+" channel by server");else if("logux/unsubscribe"===t.type)s="unsubscribed from channel "+Z(t.channel),2===Object.keys(t).length?ee(s):ee(s,{Action:t});else if("logux/processed"===t.type)if(n[t.id]){let e=n[t.id],i={"Processed Action":e};"logux/subscribe"===e.type?ee("subscribed to "+Z(e.channel)+" channel",i):ee("action "+Z(e.type)+" was processed",i),delete n[t.id]}else ee("action "+Z(t.id)+" was processed");else if("logux/undo"===t.type){s="logux/subscribe"===t.action.type?"subscription to "+Z(t.action.channel):"action "+Z(t.action.type),s+=" was undone because of "+Z(t.reason);let e={"Reverted Action":t.action};Object.keys(t).length>4&&(e["Undo Action"]=t),n[t.id]&&delete n[t.id],ee(s,e)}else{let e={Action:t,Meta:o};s="added ",0===o.reasons.length&&(r[o.id]=!0,s+="and cleaned "),s+=Z(t.type)+" action";let{nodeId:n}=M(o.id);n!==i.localNodeId&&(e.From=n),ee(s,e)}}))),!1!==t.user&&o.push(e.on("user",(t=>{ee("user ID was changed to "+Z(t),{"Node ID":e.nodeId})}))),!1!==t.clean&&o.push(e.on("clean",((t,i)=>{if(r[i.id])return void delete r[i.id];if(i.tab&&i.tab!==e.id)return;if(d[t.type])return;if(t.type.startsWith("logux/"))return;ee("cleaned "+Z(t.type)+" action",{Action:t,Meta:i})})))}(he),N(he,(e=>{document.all.status.innerText=e}));let pe=0;function me(){var e;document.title=("disconnected"===(e=he.state)?"😴":"connecting"===e?"🔌":"😊")+" "+(he.role.slice(0,1).toUpperCase()+" ")+pe}he.on("state",(()=>{document.all.connection.checked=he.connected,me()})),he.on("role",(()=>{me(),document.all.connection.disabled="leader"!==he.role})),he.on("add",(e=>{"TICK"===e.type&&pe++,me()})),he.on("clean",(e=>{"TICK"===e.type&&pe--,me()})),he.log.each((e=>{"TICK"===e.type&&pe++})).then((()=>{me()})),he.on("role",(()=>{let e="leader"===he.role;document.all.connection.disabled=!e,document.all.disabled.style.display=e?"none":"inline"})),he.start(),document.all.connection.onchange=e=>{e.target.checked?he.node.connection.connect():he.node.connection.disconnect()},document.all.add.onclick=()=>{he.log.add({type:"TICK"},{reasons:["tick"],sync:!0})},document.all.clean.onclick=()=>{he.log.removeReason("tick")},document.all.error.onclick=()=>{setTimeout((()=>{he.log.add({type:"logux/undo",reason:"error"})}),3e3)},document.all.denied.onclick=()=>{setTimeout((()=>{he.log.add({type:"logux/undo",reason:"denied"})}),3e3)},document.all.serverError.onclick=()=>{setTimeout((()=>{ae.right.send(["error","wrong-format"])}),3e3)},document.all.subprotocolError.onclick=()=>{he.node.syncError("wrong-subprotocol",{supported:"2.x",used:"1.0.0"})},"1.0.1"===he.options.subprotocol?document.all.subprotocolClient.disabled=!0:document.all.subprotocolClient.onclick=()=>{window.open(location.toString()+"#1.0.1","_blank")}}();
//# sourceMappingURL=index.56f6e8c3.js.map
