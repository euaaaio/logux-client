var R=Object.defineProperty;var S=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var E=(s,e,t)=>e in s?R(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,m=(s,e)=>{for(var t in e||(e={}))N.call(e,t)&&E(s,t,e[t]);if(S)for(var t of S(e))O.call(e,t)&&E(s,t,e[t]);return s};let w=()=>({events:{},emit(s,...e){(this.events[s]||[]).forEach(t=>t(...e))},on(s,e){return(this.events[s]=this.events[s]||[]).push(e),()=>this.events[s]=(this.events[s]||[]).filter(t=>t!==e)}});function l(s,e,t,i){t.id&&s.emit(`${e}-${t.type}-${t.id}`,t,i),s.emit(`${e}-${t.type}-`,t,i),s.emit(e,t,i)}class ne{constructor(e={}){this.nodeId=e.nodeId,this.lastTime=0,this.sequence=0,this.store=e.store,this.emitter=w()}on(e,t){return this.emitter.on(e,t)}type(e,t,i={}){let r=i.event||"add",n=i.id||"";return this.emitter.on(`${r}-${e}-${n}`,t)}async add(e,t={}){if(typeof e.type=="undefined")throw new Error('Expected "type" in action');let i=!1;if(typeof t.id=="undefined"&&(i=!0,t.id=this.generateId()),typeof t.time=="undefined"&&(t.time=parseInt(t.id)),typeof t.reasons=="undefined"&&(t.reasons=[]),l(this.emitter,"preadd",e,t),t.keepLast&&(this.removeReason(t.keepLast,{olderThan:t}),t.reasons.push(t.keepLast)),t.reasons.length===0&&i)return l(this.emitter,"add",e,t),l(this.emitter,"clean",e,t),t;if(t.reasons.length===0){let[r]=await this.store.byId(t.id);return r?!1:(l(this.emitter,"add",e,t),l(this.emitter,"clean",e,t),t)}else{let r=await this.store.add(e,t);return r===!1?!1:(l(this.emitter,"add",e,t),r)}}generateId(){let e=Date.now();return e<=this.lastTime?(e=this.lastTime,this.sequence+=1):(this.lastTime=e,this.sequence=0),e+" "+this.nodeId+" "+this.sequence}each(e,t){t||(t=e,e={order:"created"});let i=this.store;return new Promise(r=>{async function n(o){let d=await o(),h;for(let c=d.entries.length-1;c>=0;c--){let u=d.entries[c];if(h=t(u[0],u[1]),h===!1)break}h===!1||!d.next?r():n(d.next)}n(i.get.bind(i,e))})}async changeMeta(e,t){for(let i in t)if(i==="id"||i==="added"||i==="time"||i==="subprotocol"||i==="indexes")throw new Error('Meta "'+i+'" is read-only');if(t.reasons&&t.reasons.length===0){let i=await this.store.remove(e);if(i){for(let r in t)i[1][r]=t[r];l(this.emitter,"clean",i[0],i[1])}return!!i}else return this.store.changeMeta(e,t)}removeReason(e,t={}){return this.store.removeReason(e,t,(i,r)=>{l(this.emitter,"clean",i,r)})}byId(e){return this.store.byId(e)}}class re{constructor(e,t,i){if(this.connected=!1,this.emitter=w(),t)this.Class=t;else if(typeof WebSocket!="undefined")this.Class=WebSocket;else throw new Error("No WebSocket support");this.url=e,this.opts=i}init(e){e.onerror=t=>{this.emitter.emit("error",t.error||new Error("WS Error"))},e.onclose=()=>{this.onclose()},e.onmessage=t=>{let i;try{i=JSON.parse(t.data)}catch{this.error(t.data);return}this.emitter.emit("message",i)},this.ws=e}connect(){return this.ws?Promise.resolve():(this.emitter.emit("connecting"),this.init(new this.Class(this.url,void 0,this.opts)),new Promise(e=>{this.ws.onopen=()=>{this.connected=!0,this.emitter.emit("connect"),e()}}))}disconnect(){this.ws&&(this.ws.onclose=void 0,this.ws.close(),this.onclose())}on(e,t){return this.emitter.on(e,t)}send(e){this.ws&&this.ws.readyState===this.ws.OPEN?this.ws.send(JSON.stringify(e)):this.emitter.emit("error",new Error("WS was closed"))}error(e){let t=new Error("Wrong message format");t.received=e,this.emitter.emit("error",t)}onclose(){this.ws&&(this.connected=!1,this.emitter.emit("disconnect"),this.ws=void 0)}}function T(s,e){if(s&&!e)return!1;if(!s&&e)return!0;if(s.time>e.time)return!1;if(s.time<e.time)return!0;let t=s.id.split(" "),i=e.id.split(" "),r=t[1],n=i[1];if(r>n)return!1;if(r<n)return!0;let o=parseInt(t[2]),d=parseInt(i[2]);if(o>d)return!1;if(o<d)return!0;let h=parseInt(t[0]),c=parseInt(i[0]);return h>c?!1:h<c}function b(s,e){s.indexes[e]||(s.indexes[e]={added:[],entries:[]})}function p(s,e){let t=s.indexes;if(y(t)&&t.length>0)for(let i of t)e(i)}function x(s,e){return s.lastAdded+=1,e[1].added=s.lastAdded,s.added.push(e),p(e[1],t=>{b(s,t),s.indexes[t].added.push(e)}),Promise.resolve(e[1])}function L(s,e){let t=e.added,i=0,r=s.added.length-1;for(;i<=r;){let n=r+i>>1,o=s.added[n][1].added;if(o<t)i=n+1;else if(o>t)r=n-1;else{s.added.splice(n,1);break}}}function g(s,e){for(let t=s.length-1;t>=0;t--)if(e===s[t][1].id)return t;return-1}function y(s){return typeof s!="undefined"}class oe{constructor(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async add(e,t){let i=[e,t],r=t.id,n=this.entries;for(let o=0;o<n.length;o++){let[,d]=n[o];if(r===d.id)return!1;if(!T(d,t))return p(t,h=>{b(this,h);let c=this.indexes[h].entries,u=c.findIndex(I=>!T(I[1],t));c.splice(u,0,i)}),n.splice(o,0,i),x(this,i)}return p(t,o=>{b(this,o),this.indexes[o].entries.push(i)}),n.push(i),x(this,i)}async byId(e){let t=g(this.entries,e);if(t===-1)return[null,null];{let[i,r]=this.entries[t];return[i,r]}}async remove(e,t){if(typeof t=="undefined"&&(t=g(this.entries,e),t===-1))return Promise.resolve(!1);let i=[this.entries[t][0],this.entries[t][1]];return p(i[1],r=>{let n=this.indexes[r].entries,o=g(n,e);o!==-1&&n.splice(o,1)}),this.entries.splice(t,1),p(i[1],r=>{L(this.indexes[r],i[1])}),L(this,i[1]),i}async get(e={}){let t=e.index,i=this,r;return t&&(i=this.indexes[t]||{added:[],entries:[]}),e.order==="created"?r=i.entries:r=i.added,{entries:r.slice(0)}}async changeMeta(e,t){let i=g(this.entries,e);if(i===-1)return!1;{let r=this.entries[i][1];for(let n in t)r[n]=t[n];return!0}}async removeReason(e,t,i){let r=[];if(t.id){let n=g(this.entries,t.id);if(n!==-1){let o=this.entries[n][1],d=o.reasons.indexOf(e);d!==-1&&(o.reasons.splice(d,1),o.reasons.length===0&&(i(this.entries[n][0],o),this.remove(t.id)))}}else{this.entries=this.entries.filter(([d,h])=>{let c=t,u=h.reasons.indexOf(e);return u===-1||y(c.olderThan)&&!T(h,c.olderThan)||y(c.youngerThan)&&!T(c.youngerThan,h)||y(c.minAdded)&&h.added<c.minAdded||y(c.maxAdded)&&h.added>c.maxAdded?!0:(h.reasons.splice(u,1),h.reasons.length===0?(i(d,h),r.push(h),!1):!0)});let n=r.map(d=>d.added),o=d=>!n.includes(d[1].added);this.added=this.added.filter(o);for(let d of r)p(d,h=>{this.indexes[h].entries=this.indexes[h].entries.filter(o),this.indexes[h].added=this.indexes[h].added.filter(o)})}}async clean(){this.entries=[],this.added=[],this.indexes={},this.lastReceived=0,this.lastAdded=0,this.lastSent=0}async getLastAdded(){return this.lastAdded}async getLastSynced(){return{received:this.lastReceived,sent:this.lastSent}}async setLastSynced(e){typeof e.sent!="undefined"&&(this.lastSent=e.sent),typeof e.received!="undefined"&&(this.lastReceived=e.received)}}class f extends Error{static describe(e,t){return e==="timeout"?"A timeout was reached ("+t+" ms)":e==="wrong-format"?"Wrong message format in "+t:e==="unknown-message"?"Unknown message `"+t+"` type":e==="bruteforce"?"Too many wrong authentication attempts":e==="wrong-protocol"?`Logux supports protocols only from version ${t.supported}, but you use ${t.used}`:e==="wrong-subprotocol"?`Only ${t.supported} application subprotocols are supported, but you use ${t.used}`:e==="wrong-credentials"?"Wrong credentials":e}constructor(e,t,i){super(e);this.name="LoguxError",this.type=e,this.options=t,this.description=f.describe(e,t),this.received=!!i,i?(this.message="Logux received "+this.type+" error",this.description!==this.type&&(this.message+=" ("+this.description+")")):this.message=this.description,Error.captureStackTrace&&Error.captureStackTrace(this,f)}}async function P(s,e,t,i){if(!s.options.auth){s.authenticated=!0,i();return}try{if(await s.options.auth(e,t,s.remoteHeaders)){s.authenticated=!0,i();for(let n=0;n<s.unauthenticated.length;n++)s.onMessage(s.unauthenticated[n]);s.unauthenticated=[]}else s.sendError(new f("wrong-credentials")),s.destroy()}catch(r){r.name==="LoguxError"?(s.sendError(r),s.destroy()):s.error(r)}}function M(s,e){return s.remoteProtocol=e,e>=s.minProtocol?!0:(s.sendError(new f("wrong-protocol",{supported:s.minProtocol,used:e})),s.destroy(),!1)}function k(s){try{s.emitter.emit("connect")}catch(e){if(e.name==="LoguxError")return s.sendError(e),!1;throw e}return!0}async function F(){let s=["connect",this.localProtocol,this.localNodeId,this.lastReceived],e={};this.options.token&&(typeof this.options.token=="function"?e.token=await this.options.token():e.token=this.options.token),this.options.subprotocol&&(e.subprotocol=this.options.subprotocol),Object.keys(e).length>0&&s.push(e),this.options.fixTime&&(this.connectSended=this.now()),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.startTimeout(),this.send(s)}async function D(s,e){let t=["connected",this.localProtocol,this.localNodeId,[s,e]],i={};this.options.token&&(typeof this.options.token=="function"?i.token=await this.options.token():i.token=this.options.token),this.options.subprotocol&&(i.subprotocol=this.options.subprotocol),Object.keys(i).length>0&&t.push(i),Object.keys(this.localHeaders).length>0&&this.sendHeaders(this.localHeaders),this.send(t)}function H(s,e,t,i){let r=this.now();if(i||(i={}),this.remoteNodeId=e,!!M(this,s)){if(this.remoteSubprotocol=i.subprotocol||"0.0.0",!k(this)){this.destroy();return}P(this,e,i.token,()=>{this.baseTime=this.now(),this.sendConnected(r,this.baseTime),this.syncSince(t)})}}function $(s,e,t,i){if(i||(i={}),this.endTimeout(),this.remoteNodeId=e,!!M(this,s)){if(this.baseTime=t[1],this.options.fixTime){let r=this.now(),n=t[1]-t[0],o=r-this.connectSended-n;this.timeFix=Math.floor(this.connectSended-t[0]+o/2)}if(this.remoteSubprotocol=i.subprotocol||"0.0.0",!k(this)){this.destroy();return}P(this,e,i.token,()=>{this.syncSince(this.lastSent)})}}function W(s,e){this.startTimeout();let t=[];for(let[i,r]of e){let n={};for(let o in r)o==="id"?n.id=r.id.split(" "):o!=="added"&&(n[o]=r[o]);this.timeFix&&(n.time-=this.timeFix),n.id[0]=parseInt(n.id[0])-this.baseTime,n.id[2]=parseInt(n.id[2]),n.time-=this.baseTime,n.id[1]===this.localNodeId&&(n.id[2]===0?n.id=n.id[0]:n.id=[n.id[0],n.id[2]]),t.unshift(i,n)}this.syncing+=1,this.setState("sending"),this.send(["sync",s].concat(t))}function z(s){this.send(["synced",s])}async function j(s,...e){let t=[];for(let i=0;i<e.length-1;i+=2){let r=e[i],n=e[i+1];typeof n.id=="number"?n.id=n.id+this.baseTime+" "+this.remoteNodeId+" "+0:(n.id[0]=n.id[0]+this.baseTime,n.id.length===2?n.id=n.id[0]+" "+this.remoteNodeId+" "+n.id[1]:n.id=n.id.join(" ")),n.time=n.time+this.baseTime,this.timeFix&&(n.time=n.time+this.timeFix);let o=Promise.resolve([r,n]);this.options.inMap&&(o=o.then(([d,h])=>this.options.inMap(d,h)).catch(d=>{this.error(d)})),o.then(d=>d&&this.options.inFilter?this.options.inFilter(...d).then(h=>h?d:!1).catch(h=>{this.error(h)}):d).then(d=>d?(this.received&&(this.received[d[1].id]=!0),this.log.add(d[0],d[1])):!1),t.push(o)}await Promise.all(t),this.setLastReceived(s),this.sendSynced(s)}function U(s){this.endTimeout(),this.setLastSent(s),this.syncing>0&&(this.syncing-=1),this.syncing===0&&this.setState("synchronized")}function _(){this.startTimeout(),this.send(["ping",this.lastAddedCache]),this.pingTimeout&&clearTimeout(this.pingTimeout)}function q(s){this.setLastReceived(s),this.connected&&this.authenticated&&this.send(["pong",this.lastAddedCache])}function B(s){this.setLastReceived(s),this.endTimeout()}function J(s){this.send(["headers",s])}function Q(s){this.remoteHeaders=s,this.emitter.emit("headers",s)}function V(s,e){this.send(["debug",s,e])}function Y(s,e){this.emitter.emit("debug",s,e)}function G(s){let e=["error",s.type];typeof s.options!="undefined"&&e.push(s.options),this.send(e),this.emitter.emit("clientError",s)}function K(s,e){this.syncError(s,e,!0)}const X={"wrong-subprotocol":!0,"wrong-protocol":!0,timeout:!0},Z=["connect","connected","error","debug","headers"];async function A(s,e,t){let i=t.added;if(typeof i=="undefined"){let r=s.lastAddedCache;i=r>s.lastSent?r:s.lastSent}if(s.options.outMap)try{let r=await s.options.outMap(e,t);s.sendSync(i,[r])}catch(r){s.error(r)}else s.sendSync(i,[[e,t]])}class a{constructor(e,t,i,r={}){if(this.remoteNodeId=void 0,this.remoteProtocol=void 0,this.remoteSubprotocol=void 0,this.minProtocol=3,this.localProtocol=4,this.localNodeId=e,this.log=t,this.connection=i,this.options=r,this.options.ping&&!this.options.timeout)throw new Error("You must set timeout option to use ping");this.connected=!1,this.authenticated=!1,this.unauthenticated=[],this.timeFix=0,this.syncing=0,this.received={},this.lastSent=0,this.lastReceived=0,this.state="disconnected",this.emitter=w(),this.timeouts=[],this.throwsError=!0,this.unbind=[t.on("add",(n,o)=>{this.onAdd(n,o)}),i.on("connecting",()=>{this.onConnecting()}),i.on("connect",()=>{this.onConnect()}),i.on("message",n=>{this.onMessage(n)}),i.on("error",n=>{n.message==="Wrong message format"?(this.sendError(new f("wrong-format",n.received)),this.connection.disconnect("error")):this.error(n)}),i.on("disconnect",()=>{this.onDisconnect()})],this.initialized=!1,this.lastAddedCache=0,this.initializing=this.initialize(),this.localHeaders={},this.remoteHeaders={}}on(e,t){return this.emitter.on(e,t)}catch(e){this.throwsError=!1;let t=this.on("error",e);return()=>{this.throwsError=!0,t()}}waitFor(e){return this.state===e?Promise.resolve():new Promise(t=>{let i=this.on("state",()=>{this.state===e&&(i(),t())})})}destroy(){this.connection.destroy?this.connection.destroy():this.connected&&this.connection.disconnect("destroy");for(let e of this.unbind)e();clearTimeout(this.pingTimeout),this.endTimeout()}setLocalHeaders(e){this.localHeaders=e,this.connected&&this.sendHeaders(e)}send(e){if(!!this.connected){this.delayPing();try{this.connection.send(e)}catch(t){this.error(t)}}}onConnecting(){this.setState("connecting")}onConnect(){this.delayPing(),this.connected=!0}onDisconnect(){for(;this.timeouts.length>0;)this.endTimeout();this.pingTimeout&&clearTimeout(this.pingTimeout),this.authenticated=!1,this.connected=!1,this.setState("disconnected")}onMessage(e){this.delayPing();let t=e[0];if(!this.authenticated&&!Z.includes(t)){this.unauthenticated.push(e);return}this[t+"Message"](...e.slice(1))}async onAdd(e,t){if(!!this.authenticated){if(this.lastAddedCache<t.added&&(this.lastAddedCache=t.added),this.received&&this.received[t.id]){delete this.received[t.id];return}if(this.options.outFilter)try{await this.options.outFilter(e,t)&&A(this,e,t)}catch(i){this.error(i)}else A(this,e,t)}}syncError(e,t,i){let r=new f(e,t,i);if(this.emitter.emit("error",r),!X[e]&&this.throwsError)throw r}error(e){if(this.emitter.emit("error",e),this.connection.disconnect("error"),this.throwsError)throw e}setState(e){this.state!==e&&(this.state=e,this.emitter.emit("state"))}startTimeout(){if(!this.options.timeout)return;let e=this.options.timeout,t=setTimeout(()=>{this.connected&&this.connection.disconnect("timeout"),this.syncError("timeout",e)},e);this.timeouts.push(t)}endTimeout(){this.timeouts.length>0&&clearTimeout(this.timeouts.shift())}delayPing(){!this.options.ping||(this.pingTimeout&&clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{this.connected&&this.authenticated&&this.sendPing()},this.options.ping))}async syncSinceQuery(e){let t=[];await this.log.each({order:"added"},(n,o)=>o.added<=e?!1:(this.options.outFilter?t.push(this.options.outFilter(n,o).then(d=>d?[n,o]:!1).catch(d=>{this.error(d)})):t.push(Promise.resolve([n,o])),!0));let i=await Promise.all(t),r={added:0};return r.entries=i.filter(n=>(n&&r.added<n[1].added&&(r.added=n[1].added),n!==!1)),r}async syncSince(e){let t=await this.syncSinceQuery(e);!this.connected||(t.entries.length>0?this.options.outMap?Promise.all(t.entries.map(i=>this.options.outMap(i[0],i[1]))).then(i=>{this.sendSync(t.added,i)}).catch(i=>{this.error(i)}):this.sendSync(t.added,t.entries):this.setState("synchronized"))}setLastSent(e){this.lastSent<e&&(this.lastSent=e,this.log.store.setLastSynced({sent:e}))}setLastReceived(e){this.lastReceived<e&&(this.lastReceived=e),this.log.store.setLastSynced({received:e})}now(){return Date.now()}async initialize(){let[e,t]=await Promise.all([this.log.store.getLastSynced(),this.log.store.getLastAdded()]);this.initialized=!0,this.lastSent=e.sent,this.lastReceived=e.received,this.lastAddedCache=t,this.connection.connected&&this.onConnect()}sendDuilian(){this.send(["duilian",Object.keys(v)[0]])}duilianMessage(e){v[e]&&this.send(["duilian",v[e]])}}a.prototype.sendConnect=F;a.prototype.sendConnected=D;a.prototype.connectMessage=H;a.prototype.connectedMessage=$;a.prototype.sendSync=W;a.prototype.sendSynced=z;a.prototype.syncMessage=j;a.prototype.syncedMessage=U;a.prototype.sendPing=_;a.prototype.pingMessage=q;a.prototype.pongMessage=B;a.prototype.sendDebug=V;a.prototype.debugMessage=Y;a.prototype.sendError=G;a.prototype.errorMessage=K;a.prototype.sendHeaders=J;a.prototype.headersMessage=Q;const v={\u91D1\u6728\u6C34\u706B\u571F:"\u677F\u57CE\u70E7\u9505\u9152"},ee={fixTime:!0,timeout:2e4,ping:5e3};class de extends a{constructor(e,t,i,r={}){r=m(m({},ee),r);super(e,t,i,r)}onConnect(){this.connected||(this.connected=!0,this.initializing=this.initializing.then(()=>{this.connected&&this.sendConnect()}))}}class C{constructor(e,t){this.connected=!1,this.emitter=w(),this.type=t,this.pair=e}other(){return this.type==="left"?this.pair.right:this.pair.left}on(e,t){return this.emitter.on(e,t)}connect(){if(this.connected)throw new Error("Connection already established");return this.emitter.emit("connecting"),new Promise(e=>{setTimeout(()=>{this.other().connected=!0,this.connected=!0,this.other().emitter.emit("connect"),this.emitter.emit("connect"),e()},this.pair.delay)})}disconnect(e){if(this.connected)return this.connected=!1,this.emitter.emit("disconnect",e),new Promise(t=>{setTimeout(()=>{this.other().connected=!1,this.other().emitter.emit("disconnect"),t()},1)});throw new Error("Connection already finished")}send(e){if(this.connected)setTimeout(()=>{this.other().emitter.emit("message",e)},this.pair.delay);else throw new Error("Connection should be started before sending a message")}}class he{constructor(e=1){this.delay=e,this.left=new C(this,"left"),this.right=new C(this,"right")}}const te={minDelay:1e3,maxDelay:5e3,attempts:1/0},ie=["wrong-protocol","wrong-subprotocol","wrong-credentials"];class ce{constructor(e,t={}){this.connection=e,this.options=m(m({},te),t),this.reconnecting=e.connected,this.connecting=!1,this.attempts=0,this.unbind=[this.connection.on("message",o=>{o[0]==="error"&&ie.includes(o[1])&&(this.reconnecting=!1)}),this.connection.on("connecting",()=>{this.connecting=!0}),this.connection.on("connect",()=>{this.attempts=0,this.connecting=!1}),this.connection.on("disconnect",()=>{this.connecting=!1,this.reconnecting&&this.reconnect()}),()=>{clearTimeout(this.timer)}];let i=()=>{this.reconnecting&&!this.connected&&!this.connecting&&typeof document!="undefined"&&!document.hidden&&this.connect()},r=()=>{this.reconnecting&&!this.connected&&!this.connecting&&navigator.onLine&&this.connect()},n=()=>{this.disconnect("freeze")};typeof document!="undefined"&&typeof window!="undefined"&&document.addEventListener&&window.addEventListener&&(document.addEventListener("visibilitychange",i,!1),window.addEventListener("focus",r,!1),window.addEventListener("online",r,!1),window.addEventListener("resume",r,!1),window.addEventListener("freeze",n,!1),this.unbind.push(()=>{document.removeEventListener("visibilitychange",i,!1),window.removeEventListener("focus",r,!1),window.removeEventListener("online",r,!1),window.removeEventListener("resume",r,!1),window.removeEventListener("freeze",n,!1)}))}connect(){return this.attempts+=1,this.reconnecting=!0,this.connection.connect()}disconnect(e){return e!=="timeout"&&e!=="error"&&e!=="freeze"&&(this.reconnecting=!1),this.connection.disconnect(e)}destroy(){for(let e of this.unbind)e();this.disconnect("destroy")}reconnect(){if(this.attempts>this.options.attempts-1){this.reconnecting=!1,this.attempts=0;return}let e=this.nextDelay();this.timer=setTimeout(()=>{this.reconnecting&&!this.connecting&&!this.connected&&this.connect()},e)}send(...e){return this.connection.send(...e)}on(...e){return this.connection.on(...e)}nextDelay(){let e=this.options.minDelay*2**this.attempts,t=Math.random(),i=t*.5*e;return Math.floor(t*10)===1&&(i=-i),Math.min(e+i,this.options.maxDelay)||0}get connected(){return this.connection.connected}get emitter(){return this.connection.emitter}}function ae(s){s.includes(" ")&&(s=s.split(" ")[1]);let e=s.split(":");if(e.length===1)return{nodeId:s,userId:void 0,clientId:s};{let t=e[0];return{nodeId:s,userId:t,clientId:e[0]+":"+e[1]}}}let le=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s));for(;s--;){let i=t[s]&63;i<36?e+=i.toString(36):i<62?e+=(i-26).toString(36).toUpperCase():i<63?e+="_":e+="-"}return e};export{a as B,de as C,ne as L,oe as M,ce as R,re as W,l as a,f as b,w as c,he as d,T as i,le as n,ae as p};
